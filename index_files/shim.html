<!DOCTYPE html>
<!-- saved from url=(0132)blob:https://3a19du6o1k5q6eafixivriolulj03pwc9dvcczjgryigzerjm4-h799512671.scf.usercontent.goog/ef708d8f-5470-42da-bfd6-0ebceab1e7e1 -->
<html lang="my"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImExZWJmY2U1ZjYwZWY5Y2NkMGViNTc3ZmI3ZjkxZGRjODg1MDA0YzAiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxNTEyNjU3ODYyMTUwMjA2MzQyNSIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjXzExYTY5MzkwZDRiOTIwOGZfaW5kZXguaHRtbC02NTgifSwiZXhwIjoxNzU2NTczMTMwLCJpYXQiOjE3NTY1Njk1MzAsImFsZyI6IlJTMjU2In0.wPhZNu_zoautdh3C40bk1MJEHDWtwaQo24Yjvg4Sw3srA56UsKMqtt5qfKMW8zPImeyFRIsizyE3q38JshRMXVFdCs9YrJqEOBehZh0kYW22e68TyioKkPVdiNXUMYP0AcfiKAbF1vP6sJ-p8MwjUdAVKyXAxPqkyToWw-kOQzm2Q7Hz_oqKalxnQRHE7Pr2H17JCro_UQvNUZ78iq0h2rjc2FC3VMi3xF0uIsWFyw9WeR7gj2Ew7PxQbB-OGfsEkvyx5rRTI7UEukRsZBjyzXYkxUr-e52URNZLA3eGSu7-U0PWqpr7itXWxsjZJuHuwcgwpD_fGyMrQjHYUFnknw","c_11a69390d4b9208f_index.html-658")</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·Äï·Ä´·Ä†·Ä≠·ÄÖ·ÄÄ·Ä¨·Ä∏·Äï·Äº·Ä±·Ä¨-Pali Speaking</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com/"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&family=Orbitron:wght@400;700&display=swap');
        body {
            font-family: 'Pyidaungsu', sans-serif;
            transition: background-color 0.3s ease;
        }
        .light-mode {
            background-image: linear-gradient(135deg, #FFD700, #FFA500, #FF6347);
            color: #374151;
        }
        .dark-mode {
            background-color: #0b1a2e;
            color: #f3f4f6;
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease-in-out;
        }
        .dark-mode .glassmorphism {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-glass {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 8px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .btn-glass:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 40px rgba(0, 0, 0, 0.2);
        }
        .text-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .light-mode .btn-text-gradient {
            background-image: linear-gradient(135deg, #FFD700, #FFA500, #FF6347);
        }
        .dark-mode .btn-text-gradient {
            background-image: linear-gradient(135deg, #A855F7, #EC4899, #F59E0B, #10B981);
            animation: pulse-gradient 2s infinite;
        }
        @keyframes pulse-gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .light-mode .bg-yellow-100 {
            background-color: #FFFACD;
        }
        .moving-toggle {
            position: relative;
            width: 120px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            display: flex;
            align-items: center;
            padding: 4px;
            cursor: pointer;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .moving-toggle-btn {
            position: absolute;
            width: 50%;
            height: 80%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            transition: transform 0.3s ease;
        }
        .moving-toggle span {
            position: relative;
            z-index: 10;
            flex: 1;
            text-align: center;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .moving-toggle[data-lang="en"] .moving-toggle-btn {
            transform: translateX(100%);
        }
        .modal {
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            animation: slideIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .robot-card {
            border-top: 5px solid #4CAF50;
            border-bottom: 5px solid #4CAF50;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .dark-mode .robot-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .robot-input {
            border-radius: 10px;
            border: 2px solid #4CAF50;
            background-color: rgba(255, 255, 255, 0.1);
            color: inherit;
            transition: all 0.3s ease;
        }
        .robot-input:focus {
            outline: none;
            box-shadow: 0 0 8px #4CAF50;
        }
        .robot-btn {
            background: #4CAF50;
            color: white;
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        .robot-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }
        .robot-title {
            color: #4CAF50;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        .robot-nav-btn {
            background: #2D3748;
            color: white;
            border-radius: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(45, 55, 72, 0.4);
            border: 2px solid #4CAF50;
        }
        .robot-nav-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(45, 55, 72, 0.6);
        }

        /* Splash Screen specific styles and animations */
        #splash-screen {
            background: linear-gradient(to bottom, #000000, #1a273b);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 1s ease-out;
            opacity: 1;
        }
        .splash-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            text-shadow: 0 0 10px #0f0, 0 0 20px #0f0, 0 0 30px #0f0;
            animation: text-pulse 2s infinite;
        }
        @keyframes text-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        .robot-icon {
            width: 150px;
            height: 150px;
            fill: #4CAF50;
            animation: robot-float 4s infinite ease-in-out;
        }
        @keyframes robot-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .loading-bar {
            width: 300px;
            height: 10px;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 20px;
        }
        .loading-fill {
            height: 100%;
            width: 0%;
            background: #4CAF50;
            animation: loading-fill 3s forwards;
        }
        @keyframes loading-fill {
            from { width: 0%; }
            to { width: 100%; }
        }
        #main-content {
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease-in;
            display: none; /* Initially hidden */
        }
        #main-content.visible {
            opacity: 1;
            pointer-events: auto;
            display: flex;
        }
    </style>
    <!-- PWA Manifest -->
    <link rel="manifest" href="">
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.visible{visibility:visible}.fixed{position:fixed}.inset-0{inset:0px}.right-4{right:1rem}.top-4{top:1rem}.z-50{z-index:50}.z-\[100\]{z-index:100}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-8{margin-top:2rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.min-h-screen{min-height:100vh}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-sm{max-width:24rem}.flex-grow{flex-grow:1}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.text-\[\#4CAF50\]{--tw-text-opacity:1;color:rgb(76 175 80 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}@media (min-width: 640px){.sm\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media (min-width: 768px){.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-7{grid-template-columns:repeat(7, minmax(0, 1fr))}.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}</style></head>
<body class="light-mode">
    <!-- Splash Screen -->
    <div id="splash-screen" style="opacity: 0; display: none;">
        <svg class="robot-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM8 10C8 8.89543 8.89543 8 10 8C11.1046 8 12 8.89543 12 10C12 11.1046 11.1046 12 10 12C8.89543 12 8 11.1046 8 10ZM14 10C14 8.89543 14.8954 8 16 8C17.1046 8 18 8.89543 18 10C18 11.1046 17.1046 12 16 12C14.8954 12 14 11.1046 14 10ZM16.5 16C15.42 18.15 13.82 19.5 12 19.5C10.18 19.5 8.58 18.15 7.5 16H16.5Z" fill="currentColor"></path>
        </svg>
        <h1 class="splash-text mt-8">·ÄÄ·Äº·Ä≠·ÄØ·ÄÜ·Ä≠·ÄØ·Äï·Ä´·Äê·Äö·Ä∫</h1>
        <div class="loading-bar">
            <div class="loading-fill"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="min-h-screen flex flex-col items-center justify-center p-4 visible">
        <!-- PWA Install Prompt -->
        <div id="install-prompt-container" class="fixed top-4 right-4 z-50 hidden">
            <div class="glassmorphism p-3 rounded-lg flex items-center space-x-2">
                <span id="install-text">App ·ÄÄ·Ä≠·ÄØ Install ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫</span>
                <button id="install-button" class="btn-glass px-4 py-2 text-white">Install</button>
            </div>
        </div>

        <!-- Main Content Wrapper -->
        <div class="w-full max-w-4xl p-8 robot-card text-gray-800 dark-text flex-grow flex flex-col">
            <!-- Header with controls -->
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-center robot-title">·Äï·Ä´·Ä†·Ä≠·ÄÖ·ÄÄ·Ä¨·Ä∏·Äï·Äº·Ä±·Ä¨-Pali Speaking</h1>
                <div class="flex items-center space-x-4">
                    <!-- Dark/Light Mode Toggle -->
                    <button id="mode-toggle" class="btn-glass px-4 py-2">
                        <span id="mode-text">Dark Mode</span>
                    </button>
                    <!-- Language Toggle -->
                    <div id="lang-toggle" class="moving-toggle" data-lang="my">
                        <div class="moving-toggle-btn"></div>
                        <span data-lang-val="my" class="text-gray-800">MY</span>
                        <span data-lang-val="en" class="text-gray-400">EN</span>
                    </div>
                    <!-- Admin Login Button -->
                    <button id="admin-login-btn" class="robot-btn px-4 py-2">Admin</button>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-4 mb-8">
                <button id="nav-videos" class="robot-nav-btn p-4 text-white font-bold text-xl">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ</button>
                <button id="nav-teachers" class="robot-nav-btn p-4 text-white font-bold text-xl">·ÄÜ·Äõ·Ä¨·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏</button>
                <button id="nav-schedule" class="robot-nav-btn p-4 text-white font-bold text-xl">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏</button>
                <button id="nav-posts" class="robot-nav-btn p-4 text-white font-bold text-xl">·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏</button>
                <button id="nav-history" class="robot-nav-btn p-4 text-white font-bold text-xl">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äû·Äô·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏</button>
                <button id="nav-contact" class="robot-nav-btn p-4 text-white font-bold text-xl">·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫</button>
                <button id="nav-pali-tutor" class="robot-nav-btn p-4 text-white font-bold text-xl">·Äï·Ä´·Ä†·Ä≠ Tutor ‚ú®</button>
            </div>

            <!-- Content Area -->
            <div id="content-area" class="flex-grow flex flex-col">
                <h2 class="text-3xl font-bold mb-6 text-center robot-title">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Äô·Äª·Ä¨·Ä∏</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div></div>
        </div>

        <!-- Notification/Custom Modal -->
        <div id="custom-modal" class="fixed inset-0 hidden items-center justify-center z-[100] modal">
            <div class="robot-card p-6 rounded-xl w-full max-w-sm modal-content text-center">
                <h3 id="modal-title" class="text-2xl font-bold mb-4 text-[#4CAF50]"></h3>
                <p id="modal-message" class="mb-4"></p>
                <input id="modal-input" type="password" class="robot-input w-full p-3 mb-4 hidden">
                <div id="modal-buttons" class="flex justify-end space-x-2"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let isAdmin = false;
        let currentLang = 'my';
        let isDark = false;
        let deferredPrompt;
        
        // This is a crucial part of the code that will handle user authentication
        async function authenticateUser() {
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                currentUser = auth.currentUser;
                // No name login anymore, so just go to main content
                hideSplashAndShowMain();
            } catch (error) {
                console.error("Error during authentication: ", error);
                hideSplashAndShowMain(); // Still show content even if auth fails
            }
        }
        
        // Function to hide splash screen and show main content
        const hideSplashAndShowMain = () => {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                document.getElementById('main-content').classList.add('visible');
                // Initial view to videos
                document.getElementById('nav-videos').click();
            }, 1000); // Wait for the fade out to finish
        };

        // Call the authentication function on page load
        window.onload = authenticateUser;

        // Function to convert base64 to ArrayBuffer
        function base64ToArrayBuffer(base64) {
            const binary_string = window.atob(base64);
            const len = binary_string.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binary_string.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // Function to convert PCM to WAV
        function pcmToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const headerSize = 44;
            const totalLength = pcmData.byteLength + headerSize;

            const buffer = new ArrayBuffer(totalLength);
            const view = new DataView(buffer);

            // Write WAV header
            let offset = 0;
            const writeString = (str) => {
                for (let i = 0; i < str.length; i++) {
                    view.setUint8(offset++, str.charCodeAt(i));
                }
            };
            const writeUint32 = (data) => {
                view.setUint32(offset, data, true);
                offset += 4;
            };
            const writeUint16 = (data) => {
                view.setUint16(offset, data, true);
                offset += 2;
            };

            // RIFF chunk
            writeString('RIFF');
            writeUint32(totalLength - 8);
            writeString('WAVE');

            // fmt chunk
            writeString('fmt ');
            writeUint32(16); // Chunk size
            writeUint16(1);  // Audio format (1 = PCM)
            writeUint16(numChannels);
            writeUint32(sampleRate);
            writeUint32(sampleRate * numChannels * bytesPerSample); // Byte rate
            writeUint16(numChannels * bytesPerSample); // Block align
            writeUint16(bytesPerSample * 8); // Bits per sample

            // data chunk
            writeString('data');
            writeUint32(pcmData.byteLength);

            // Write PCM data
            const pcmBytes = new Uint8Array(pcmData.buffer);
            for (let i = 0; i < pcmBytes.length; i++) {
                view.setUint8(offset++, pcmBytes[i]);
            }

            return new Blob([view], { type: 'audio/wav' });
        }

        const translations = {
            'my': {
                'app_title': '·Äï·Ä´·Ä†·Ä≠·ÄÖ·ÄÄ·Ä¨·Ä∏·Äï·Äº·Ä±·Ä¨-Pali Speaking',
                'nav_videos': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ',
                'nav_teachers': '·ÄÜ·Äõ·Ä¨·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏',
                'nav_schedule': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏',
                'nav_posts': '·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏',
                'nav_history': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äû·Äô·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏',
                'nav_contact': '·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫',
                'nav_pali_tutor': '·Äï·Ä´·Ä†·Ä≠ Tutor ‚ú®',
                'mode_dark': 'Dark Mode',
                'mode_light': 'Light Mode',
                'install_text': 'App ·ÄÄ·Ä≠·ÄØ Install ·Äú·ÄØ·Äï·Ä∫·Äõ·Äî·Ä∫',
                'install_button': 'Install',
                'admin_login_btn': 'Admin',
                'logout_btn': '·Äë·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫',
                'videos_title': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Äô·Äª·Ä¨·Ä∏',
                'posts_title': '·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Äô·Äª·Ä¨·Ä∏',
                'teachers_title': '·ÄÜ·Äõ·Ä¨·Äô·Äª·Ä¨·Ä∏',
                'schedule_title': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏',
                'history_title': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äû·Äô·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏',
                'contact_title': '·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫',
                'contact_info': 'Viber ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫',
                'admin_panel_title': 'Admin Panel',
                'add_video': '·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Ä°·Äû·ÄÖ·Ä∫·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫',
                'edit_video': '·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Äï·Äº·ÄØ·Äï·Äº·ÄÑ·Ä∫·Äõ·Äî·Ä∫',
                'video_link': '·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Äú·ÄÑ·Ä∑·Ä∫·ÄÅ·Ä∫ (Telegram)',
                'teacher_name': '·ÄÜ·Äõ·Ä¨·Ä°·Äô·Ää·Ä∫',
                'course_title': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫',
                'date': '·Äõ·ÄÄ·Ä∫·ÄÖ·ÄΩ·Ä≤',
                'add_post': '·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫',
                'post_title': '·Äï·Ä≠·ÄØ·ÄÖ·Ä∑·Ä∫·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·ÄÖ·Äâ·Ä∫',
                'post_content': '·Äï·Ä≠·ÄØ·ÄÖ·Ä∑·Ä∫·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨',
                'post_image': '·Äì·Ä¨·Äê·Ä∫·Äï·ÄØ·Ä∂·Äú·ÄÑ·Ä∑·Ä∫·ÄÅ·Ä∫',
                'update_contact': '·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫ ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äõ·Äî·Ä∫',
                'viber_number': 'Viber ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫',
                'save': '·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫',
                'cancel': '·Äñ·Äª·ÄÄ·Ä∫·Äû·Ä≠·Äô·Ä∫·Ä∏·Äõ·Äî·Ä∫',
                'admin_login_success': 'Admin Login ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫',
                'admin_login_fail': 'Login ·Äô·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´',
                'admin_password_placeholder': '·ÄÖ·ÄÄ·Ä¨·Ä∏·Äù·Äæ·ÄÄ·Ä∫',
                'new_video_notif_title': '·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Ä°·Äû·ÄÖ·Ä∫',
                'new_video_notif_body': '·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·Ä°·Äû·ÄÖ·Ä∫ ·Äõ·Ä±·Ä¨·ÄÄ·Ä∫·Äõ·Äæ·Ä≠·Äú·Ä¨·Äï·Ä´·Äï·Äº·ÄÆ',
                'new_post_notif_title': '·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Ä°·Äû·ÄÖ·Ä∫',
                'new_post_notif_body': '·Äï·Ä≠·ÄØ·Ä∑·ÄÖ·Ä∫·Ä°·Äû·ÄÖ·Ä∫·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ ·Äê·ÄÑ·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫',
                'tutor_title': '·Äï·Ä´·Ä†·Ä≠ Tutor',
                'tutor_placeholder': '·Äï·Ä´·Ä†·Ä≠·ÄÖ·ÄÄ·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏ ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·Äû·Äí·Äπ·Äí·Ä´·ÄÖ·Ää·Ä∫·Ä∏·Äô·Äª·Äâ·Ä∫·Ä∏·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·ÄØ·ÄÄ·Ä≠·ÄØ ·Äô·Ä±·Ä∏·Äï·Ä´...',
                'tutor_ask_btn': '·Äô·Ä±·Ä∏·Äõ·Äî·Ä∫ ‚ú®',
                'tutor_speak_btn': '·Ä°·Äû·Ä∂·Äë·ÄΩ·ÄÄ·Ä∫ ·Äî·Ä¨·Ä∏·Äë·Ä±·Ä¨·ÄÑ·Ä∫·Äõ·Äî·Ä∫ üîä',
                'tutor_loading': '·ÄÖ·Äâ·Ä∫·Ä∏·ÄÖ·Ä¨·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫...',
                'tutor_error': '·Ä°·Äô·Äæ·Ä¨·Ä∏·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·ÄØ ·Äñ·Äº·ÄÖ·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã ·Äë·Äï·Ä∫·Äô·Ä∂·ÄÄ·Äº·Ä≠·ÄØ·Ä∏·ÄÖ·Ä¨·Ä∏·Äï·Ä´·Åã',
            },
            'en': {
                'app_title': 'Pali Speaking',
                'nav_videos': 'Videos',
                'nav_teachers': 'Teachers',
                'nav_schedule': 'Schedule',
                'nav_posts': 'Posts',
                'nav_history': 'History',
                'nav_contact': 'Contact',
                'nav_pali_tutor': 'Pali Tutor ‚ú®',
                'mode_dark': 'Dark Mode',
                'mode_light': 'Light Mode',
                'install_text': 'Install the App',
                'install_button': 'Install',
                'admin_login_btn': 'Admin',
                'logout_btn': 'Logout',
                'videos_title': 'Course Videos',
                'posts_title': 'Posts',
                'teachers_title': 'Teachers',
                'schedule_title': 'Course Schedule',
                'history_title': 'Course History',
                'contact_title': 'Contact Us',
                'contact_info': 'Viber Phone Number',
                'admin_panel_title': 'Admin Panel',
                'add_video': 'Add New Video',
                'edit_video': 'Edit Video',
                'video_link': 'Video Link (Telegram)',
                'teacher_name': 'Teacher Name',
                'course_title': 'Course Title',
                'date': 'Date',
                'add_post': 'Add New Post',
                'post_title': 'Post Title',
                'post_content': 'Post Content',
                'post_image': 'Image Link',
                'update_contact': 'Update Contact Number',
                'viber_number': 'Viber Phone Number',
                'save': 'Save',
                'cancel': 'Cancel',
                'admin_login_success': 'Admin Login Successful',
                'admin_login_fail': 'Login Failed',
                'admin_password_placeholder': 'Password',
                'new_video_notif_title': 'New Course',
                'new_video_notif_body': 'A new video is available',
                'new_post_notif_title': 'New Post',
                'new_post_notif_body': 'A new post has been published',
                'tutor_title': 'Pali Tutor',
                'tutor_placeholder': 'Ask about a Pali word or grammar rule...',
                'tutor_ask_btn': 'Ask ‚ú®',
                'tutor_speak_btn': 'Listen to pronunciation üîä',
                'tutor_loading': 'Thinking...',
                'tutor_error': 'An error occurred. Please try again.',
            }
        };

        const getLangText = (key) => {
            return translations[currentLang][key] || key;
        };

        const updateUI = () => {
            document.querySelectorAll('[id^="nav-"]').forEach(btn => {
                const key = btn.id.replace('nav-', 'nav_').replace(/-/g, '_');
                btn.textContent = getLangText(key);
            });
            document.getElementById('mode-text').textContent = isDark ? getLangText('mode_light') : getLangText('mode_dark');
            document.getElementById('install-text').textContent = getLangText('install_text');
            document.getElementById('install-button').textContent = getLangText('install_button');
            document.getElementById('admin-login-btn').textContent = getLangText('admin_login_btn');
            
            const mainTitleEl = document.querySelector('#main-content h1');
            if (mainTitleEl) mainTitleEl.textContent = getLangText('app_title');
        };

        const showModal = (title, message, buttons) => {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const btnContainer = document.getElementById('modal-buttons');
            btnContainer.innerHTML = '';
            buttons.forEach(btn => {
                const btnEl = document.createElement('button');
                btnEl.className = `robot-btn px-4 py-2 rounded-lg text-white font-bold transition-transform transform hover:scale-105`;
                btnEl.textContent = btn.text;
                btnEl.onclick = btn.handler;
                btnContainer.appendChild(btnEl);
            });
            modal.style.display = 'flex';
        };

        const hideModal = () => {
            document.getElementById('custom-modal').style.display = 'none';
        };

        const showNotification = (title, body) => {
            const audio = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
            audio.play().catch(e => console.error("Audio playback failed:", e));
            showModal(title, body, [{ text: 'OK', handler: hideModal }]);
        };

        const renderAdminPanel = async () => {
            const adminPanelHTML = `
                <div class="p-6 robot-card flex-grow overflow-y-auto">
                    <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('admin_panel_title')}</h2>
                    <!-- Videos Section -->
                    <div class="mb-8">
                        <h3 class="text-2xl font-semibold mb-4 text-[#4CAF50]">${getLangText('add_video')}</h3>
                        <form id="add-video-form" class="space-y-4">
                            <input type="text" id="video-link" placeholder="${getLangText('video_link')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <input type="text" id="teacher-name" placeholder="${getLangText('teacher_name')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <input type="text" id="course-title" placeholder="${getLangText('course_title')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <input type="date" id="video-date" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <button type="submit" class="robot-btn w-full py-3 text-lg font-bold">
                                ${getLangText('save')}
                            </button>
                        </form>
                    </div>

                    <!-- Posts Section -->
                    <div class="mb-8">
                        <h3 class="text-2xl font-semibold mb-4 text-[#4CAF50]">${getLangText('add_post')}</h3>
                        <form id="add-post-form" class="space-y-4">
                            <input type="text" id="post-title" placeholder="${getLangText('post_title')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <textarea id="post-content" placeholder="${getLangText('post_content')}" rows="5" class="w-full p-3 rounded-lg robot-input text-gray-800"></textarea>
                            <input type="text" id="post-image-link" placeholder="${getLangText('post_image')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <button type="submit" class="robot-btn w-full py-3 text-lg font-bold">
                                ${getLangText('save')}
                            </button>
                        </form>
                    </div>

                    <!-- Contact Section -->
                    <div class="mb-8">
                        <h3 class="text-2xl font-semibold mb-4 text-[#4CAF50]">${getLangText('update_contact')}</h3>
                        <form id="update-contact-form" class="space-y-4">
                            <input type="text" id="viber-number-input" placeholder="${getLangText('viber_number')}" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <button type="submit" class="robot-btn w-full py-3 text-lg font-bold">
                                ${getLangText('save')}
                            </button>
                        </form>
                    </div>
                    
                    <!-- Font Selection Section -->
                    <div class="mb-8">
                        <h3 class="text-2xl font-semibold mb-4 text-[#4CAF50]">·Äñ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫</h3>
                        <form id="font-form" class="space-y-4">
                            <input type="text" id="font-url-input" placeholder="·Äñ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫ URL" class="w-full p-3 rounded-lg robot-input text-gray-800">
                            <button type="submit" class="robot-btn w-full py-3 text-lg font-bold">
                                ·Äñ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äë·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫
                            </button>
                        </form>
                    </div>
                </div>
            `;
            document.getElementById('content-area').innerHTML = adminPanelHTML;

            // Handle forms
            document.getElementById('add-video-form').addEventListener('submit', handleAddVideo);
            document.getElementById('add-post-form').addEventListener('submit', handleAddPost);
            document.getElementById('update-contact-form').addEventListener('submit', handleUpdateContact);
            document.getElementById('font-form').addEventListener('submit', handleFontUpdate);

            // Load existing data for editing
            const contactRef = doc(db, `artifacts/${appId}/public/data/contact`, 'main');
            const contactSnap = await getDoc(contactRef);
            if (contactSnap.exists()) {
                document.getElementById('viber-number-input').value = contactSnap.data().number;
            }
        };

        const renderVideos = (videos) => {
            let videoListHTML = `
                <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('videos_title')}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;
            videos.forEach(video => {
                videoListHTML += `
                    <div class="robot-card p-4 rounded-lg flex flex-col space-y-2">
                        <h3 class="text-xl font-bold">${video.courseTitle}</h3>
                        <p class="text-sm font-semibold">${getLangText('teacher_name')}: ${video.teacherName}</p>
                        <p class="text-sm">${video.date}</p>
                        <a href="${video.link}" target="_blank" class="robot-btn w-full py-2 text-center text-lg font-bold">
                            ·Äó·ÄÆ·Äí·ÄÆ·Äö·Ä≠·ÄØ·ÄÄ·Äº·Ää·Ä∑·Ä∫·Äõ·Äî·Ä∫
                        </a>
                        ${isAdmin ? `<button class="robot-btn w-full py-2 text-center mt-2" onclick="handleDelete('videos', '${video.id}')">
                                ·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫
                            </button>` : ''}
                    </div>
                `;
            });
            videoListHTML += `</div>`;
            document.getElementById('content-area').innerHTML = videoListHTML;
        };

        const renderPosts = (posts) => {
            let postListHTML = `
                <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('posts_title')}</h2>
                <div class="space-y-6">
            `;
            posts.forEach(post => {
                postListHTML += `
                    <div class="robot-card p-6 rounded-lg">
                        ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" class="w-full h-auto rounded-lg mb-4">` : ''}
                        <h3 class="text-2xl font-bold mb-2">${post.title}</h3>
                        <p>${post.content}</p>
                        ${isAdmin ? `<button class="robot-btn w-full py-2 text-center mt-4" onclick="handleDelete('posts', '${post.id}')">
                                ·Äñ·Äª·ÄÄ·Ä∫·Äõ·Äî·Ä∫
                            </button>` : ''}
                    </div>
                `;
            });
            postListHTML += `</div>`;
            document.getElementById('content-area').innerHTML = postListHTML;
        };

        const renderTeachers = (teachers) => {
            let teacherListHTML = `
                <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('teachers_title')}</h2>
                <div class="space-y-4">
            `;
            const uniqueTeachers = [...new Set(teachers.map(t => t.teacherName))];
            uniqueTeachers.forEach(teacher => {
                teacherListHTML += `
                    <div class="robot-card p-4 rounded-lg">
                        <h3 class="text-xl font-bold">${teacher}</h3>
                    </div>
                `;
            });
            teacherListHTML += `</div>`;
            document.getElementById('content-area').innerHTML = teacherListHTML;
        };
        
        const renderSchedule = () => {
             document.getElementById('content-area').innerHTML = `<h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('schedule_title')}</h2><p class="text-center">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫·ÄÖ·Ä¨·Äõ·ÄÑ·Ä∫·Ä∏·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äô·ÄÄ·Äº·Ä¨·Äô·ÄÆ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Äô·Ää·Ä∫·Åã</p>`;
        }
        
        const renderHistory = () => {
             document.getElementById('content-area').innerHTML = `<h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('history_title')}</h2><p class="text-center">·Äû·ÄÑ·Ä∫·Äê·Äî·Ä∫·Ä∏·Äû·Äô·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏·Ä°·ÄÄ·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Ä°·Äõ·Ä¨·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Äô·ÄÄ·Äº·Ä¨·Äô·ÄÆ·Äë·Ää·Ä∑·Ä∫·Äû·ÄΩ·ÄÑ·Ä∫·Ä∏·Äï·Ä´·Äô·Ää·Ä∫·Åã</p>`;
        }
        
        const renderContact = async () => {
            const contactRef = doc(db, `artifacts/${appId}/public/data/contact`, 'main');
            const contactSnap = await getDoc(contactRef);
            const number = contactSnap.exists() ? contactSnap.data().number : 'N/A';
            document.getElementById('content-area').innerHTML = `
                <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('contact_title')}</h2>
                <div class="robot-card p-6 rounded-lg text-center">
                    <p class="text-xl">${getLangText('contact_info')}:</p>
                    <p class="text-2xl font-bold">${number}</p>
                    <p class="text-sm mt-4">·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·ÄÄ·Ä≠·ÄØ ·Äî·Äæ·Ä≠·Äï·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´·ÄÄ Viber ·Äû·Ä≠·ÄØ·Ä∑ ·Äê·Äî·Ä∫·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äô·Ää·Ä∫·Åã</p>
                    <a href="viber://chat?number=${number.replace(/\s/g, '')}" target="_blank" class="robot-btn w-full py-2 text-center mt-4">
                        Viber ·Äû·Ä≠·ÄØ·Ä∑ ·ÄÜ·ÄÄ·Ä∫·Äû·ÄΩ·Äö·Ä∫·Äõ·Äî·Ä∫
                    </a>
                </div>
            `;
        };

        const renderPaliTutor = () => {
            document.getElementById('content-area').innerHTML = `
                <div class="flex flex-col p-6 robot-card flex-grow overflow-y-auto">
                    <h2 class="text-3xl font-bold mb-6 text-center robot-title">${getLangText('tutor_title')}</h2>
                    <p class="text-center mb-4">·Äï·Ä´·Ä†·Ä≠·Äò·Ä¨·Äû·Ä¨·ÄÖ·ÄÄ·Ä¨·Ä∏·Äî·Ä≤·Ä∑·Äï·Äê·Ä∫·Äû·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏ ·Äû·Ä≠·Äú·Ä≠·ÄØ·Äê·Ä¨·ÄÄ·Ä≠·ÄØ ·Äô·Ä±·Ä∏·Äô·Äº·Äî·Ä∫·Ä∏·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äï·Ä´·Äê·Äö·Ä∫·Åã</p>
                    <textarea id="pali-tutor-input" placeholder="${getLangText('tutor_placeholder')}" rows="5" class="w-full p-3 rounded-lg robot-input text-gray-800 mb-4"></textarea>
                    <div class="flex space-x-4">
                        <button id="pali-tutor-ask-btn" class="robot-btn w-1/2 py-3 text-lg font-bold">
                            ${getLangText('tutor_ask_btn')}
                        </button>
                        <button id="pali-tutor-speak-btn" class="robot-btn w-1/2 py-3 text-lg font-bold">
                            ${getLangText('tutor_speak_btn')}
                        </button>
                    </div>
                    <div id="pali-tutor-output" class="mt-6 p-6 robot-card rounded-lg flex-grow overflow-y-auto">
                        <p id="tutor-response" class="whitespace-pre-wrap"></p>
                    </div>
                </div>
            `;

            document.getElementById('pali-tutor-ask-btn').addEventListener('click', handleGeminiRequest);
            document.getElementById('pali-tutor-speak-btn').addEventListener('click', handleGeminiTTS);
        };
        
        // Gemini API Functions
        const handleGeminiRequest = async () => {
            const inputElement = document.getElementById('pali-tutor-input');
            const outputElement = document.getElementById('tutor-response');
            const askBtn = document.getElementById('pali-tutor-ask-btn');
            const query = inputElement.value;

            if (!query) return;

            askBtn.disabled = true;
            outputElement.textContent = getLangText('tutor_loading');

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = `You are a helpful and knowledgeable Pali language tutor. Your role is to provide clear, concise, and accurate explanations of Pali grammar, vocabulary, and concepts in both Burmese and English. Translate phrases, explain grammar rules, and give examples. Use Pyidaungsu font for Burmese text.`;
            const userQuery = `·Ä°·Ä±·Ä¨·ÄÄ·Ä∫·Äï·Ä´·Äô·Ä±·Ä∏·ÄÅ·ÄΩ·Äî·Ä∫·Ä∏·ÄÄ·Ä≠·ÄØ ·Äï·Ä´·Ä†·Ä≠ Tutor ·Äê·ÄÖ·Ä∫·Äö·Ä±·Ä¨·ÄÄ·Ä∫·Ä°·Äî·Ä±·Äî·Ä≤·Ä∑ ·Äô·Äº·Äî·Ä∫·Äô·Ä¨·Äú·Ä≠·ÄØ ·Äï·Äº·Äî·Ä∫·Äñ·Äº·Ä±·Äï·Ä±·Ä∏·Äï·Ä´·Åã ·Äô·Ä∞·Äõ·ÄÑ·Ä∫·Ä∏·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ·Äú·Ää·Ä∫·Ä∏ ·Äï·Ä´·Ä†·Ä≠·Ä°·ÄÄ·Äπ·ÄÅ·Äõ·Ä¨·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äñ·Ä±·Ä¨·Ä∫·Äï·Äº·Äï·Ä±·Ä∏·Äï·Ä´·Åã \n\n·Äô·Ä±·Ä∏·ÄÅ·ÄΩ·Äî·Ä∫·Ä∏: ${query}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let retries = 0;
            const maxRetries = 3;

            const fetchData = async () => {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return await response.json();
                } catch (error) {
                    if (retries < maxRetries) {
                        retries++;
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return fetchData();
                    } else {
                        throw error;
                    }
                }
            };

            try {
                const result = await fetchData();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || getLangText('tutor_error');
                outputElement.textContent = text;
            } catch (error) {
                console.error("Error with Gemini API:", error);
                outputElement.textContent = getLangText('tutor_error');
            } finally {
                askBtn.disabled = false;
            }
        };

        const handleGeminiTTS = async () => {
            const textToSpeak = document.getElementById('tutor-response').textContent;
            const speakBtn = document.getElementById('pali-tutor-speak-btn');
            if (!textToSpeak || textToSpeak.length > 400) {
                 showModal('·Äû·Äê·Ä≠·Äï·Ä±·Ä∏·ÄÅ·Äª·ÄÄ·Ä∫', '·Ä°·Äû·Ä∂·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äõ·Äî·Ä∫ ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ ·ÄÖ·Ä¨·Äû·Ä¨·Ä∏·Äû·Ää·Ä∫ ·Ä°·Äú·ÄΩ·Äî·Ä∫·Äõ·Äæ·Ää·Ä∫·Äú·Äª·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã', [{ text: 'OK', handler: hideModal }]);
                 return;
            }

            speakBtn.disabled = true;

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: textToSpeak }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Kore" }
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            let retries = 0;
            const maxRetries = 3;

            const fetchData = async () => {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return await response.json();
                } catch (error) {
                    if (retries < maxRetries) {
                        retries++;
                        const delay = Math.pow(2, retries) * 1000;
                        await new Promise(res => setTimeout(res, delay));
                        return fetchData();
                    } else {
                        throw error;
                    }
                }
            };
            
            try {
                const result = await fetchData();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                    const pcmData = base64ToArrayBuffer(audioData);
                    const wavBlob = pcmToWav(pcmData, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                } else {
                    showModal('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Ä°·Äû·Ä∂·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·Äº·Äø·Äî·Ä¨ ·Äõ·Äæ·Ä≠·Äï·Ä´·Äû·Ää·Ä∫·Åã', [{ text: 'OK', handler: hideModal }]);
                }
            } catch (error) {
                console.error("Error with TTS API:", error);
                showModal('·Ä°·Äô·Äæ·Ä¨·Ä∏', '·Ä°·Äû·Ä∂·Äñ·Ä≠·ÄØ·ÄÑ·Ä∫ ·Äñ·Äî·Ä∫·Äê·ÄÆ·Ä∏·Äõ·Ä¨·Äê·ÄΩ·ÄÑ·Ä∫ ·Äï·Äº·Äø·Äî·Ä¨ ·Äõ·Äæ·Ä≠·Äï·Ä´·Äû·Ää·Ä∫·Åã', [{ text: 'OK', handler: hideModal }]);
            } finally {
                speakBtn.disabled = false;
            }
        };


        // Data Handling Functions (Firestore)
        const videosCollection = collection(db, `artifacts/${appId}/public/data/videos`);
        const postsCollection = collection(db, `artifacts/${appId}/public/data/posts`);

        const handleAddVideo = async (e) => {
            e.preventDefault();
            const form = e.target;
            const videoData = {
                link: form['video-link'].value,
                teacherName: form['teacher-name'].value,
                courseTitle: form['course-title'].value,
                date: form['video-date'].value,
                createdAt: new Date()
            };
            try {
                await addDoc(videosCollection, videoData);
                form.reset();
                showNotification(getLangText('new_video_notif_title'), getLangText('new_video_notif_body'));
            } catch (error) {
                console.error("Error adding video: ", error);
            }
        };

        const handleAddPost = async (e) => {
            e.preventDefault();
            const form = e.target;
            const postData = {
                title: form['post-title'].value,
                content: form['post-content'].value,
                imageUrl: form['post-image-link'].value,
                createdAt: new Date()
            };
            try {
                await addDoc(postsCollection, postData);
                form.reset();
                showNotification(getLangText('new_post_notif_title'), getLangText('new_post_notif_body'));
            } catch (error) {
                console.error("Error adding post: ", error);
            }
        };
        
        const handleUpdateContact = async (e) => {
            e.preventDefault();
            const number = document.getElementById('viber-number-input').value;
            const contactRef = doc(db, `artifacts/${appId}/public/data/contact`, 'main');
            try {
                await setDoc(contactRef, { number });
                showModal('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', 'Viber ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ', [{ text: 'OK', handler: hideModal }]);
            } catch (error) {
                console.error("Error updating contact: ", error);
            }
        };
        
        const handleFontUpdate = async (e) => {
             e.preventDefault();
             const fontUrl = document.getElementById('font-url-input').value;
             const styleEl = document.createElement('style');
             styleEl.innerHTML = `@font-face { font-family: 'CustomFont'; src: url('${fontUrl}'); } body { font-family: 'CustomFont', sans-serif; }`;
             document.head.appendChild(styleEl);
             showModal('·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äô·Äº·ÄÑ·Ä∫·Äï·Ä´·Äû·Ää·Ä∫', '·Äñ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ', [{ text: 'OK', handler: hideModal }]);
        }
        
        window.handleDelete = async (collectionName, docId) => {
            const collectionRef = collection(db, `artifacts/${appId}/public/data/${collectionName}`);
            await deleteDoc(doc(collectionRef, docId));
            showModal('·Äñ·Äª·ÄÄ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ', '·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´·Äï·Äº·ÄÆ', [{ text: 'OK', handler: hideModal }]);
        };

        // Event Listeners
        document.getElementById('admin-login-btn').addEventListener('click', () => {
            const passwordInput = document.getElementById('modal-input');
            passwordInput.value = '';
            passwordInput.classList.remove('hidden');

            const handleLogin = () => {
                if (passwordInput.value === 'sivali') {
                    isAdmin = true;
                    hideModal();
                    // Go to admin panel, no need for main content render logic
                    renderAdminPanel();
                    document.getElementById('admin-login-btn').classList.add('hidden');
                    showModal(getLangText('admin_login_success'), '', [{ text: 'OK', handler: hideModal }]);
                } else {
                    showModal(getLangText('admin_login_fail'), 'Password ·Äô·Äæ·Ä¨·Ä∏·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äî·Ä±·Äï·Ä´·Äû·Ää·Ä∫', [{ text: 'OK', handler: hideModal }]);
                }
            };
            
            showModal(
                'Admin Login',
                'Password ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´',
                [
                    { text: 'Cancel', handler: hideModal },
                    { text: 'Login', handler: handleLogin }
                ]
            );

            passwordInput.focus();
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            }, { once: true });
        });

        document.getElementById('mode-toggle').addEventListener('click', () => {
            isDark = !isDark;
            document.body.classList.toggle('dark-mode', isDark);
            document.body.classList.toggle('light-mode', !isDark);
            updateUI();
        });

        document.getElementById('lang-toggle').addEventListener('click', () => {
            currentLang = currentLang === 'my' ? 'en' : 'my';
            document.getElementById('lang-toggle').dataset.lang = currentLang;
            updateUI();
        });

        // PWA Install Prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt-container').style.display = 'block';
        });

        document.getElementById('install-button').addEventListener('click', () => {
            document.getElementById('install-prompt-container').style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            }
        });

        document.getElementById('nav-videos').addEventListener('click', () => {
            onSnapshot(query(videosCollection), (querySnapshot) => {
                const videos = [];
                querySnapshot.forEach((doc) => {
                    videos.push({ id: doc.id, ...doc.data() });
                });
                renderVideos(videos);
            });
        });
        
        document.getElementById('nav-posts').addEventListener('click', () => {
            onSnapshot(query(postsCollection), (querySnapshot) => {
                const posts = [];
                querySnapshot.forEach((doc) => {
                    posts.push({ id: doc.id, ...doc.data() });
                });
                renderPosts(posts);
            });
        });
        
        document.getElementById('nav-teachers').addEventListener('click', async () => {
            const querySnapshot = await getDocs(videosCollection);
            const videos = querySnapshot.docs.map(doc => doc.data());
            renderTeachers(videos);
        });
        
        document.getElementById('nav-schedule').addEventListener('click', renderSchedule);
        document.getElementById('nav-history').addEventListener('click', renderHistory);
        document.getElementById('nav-contact').addEventListener('click', renderContact);
        document.getElementById('nav-pali-tutor').addEventListener('click', renderPaliTutor);
        
        updateUI();

    </script>


</body></html>